<!doctype html>
<!--[if lt IE 7]>      <html class="no-js lt-ie9 lt-ie8 lt-ie7" lang=""> <![endif]-->
<!--[if IE 7]>         <html class="no-js lt-ie9 lt-ie8" lang=""> <![endif]-->
<!--[if IE 8]>         <html class="no-js lt-ie9" lang=""> <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang=""> <!--<![endif]-->
<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <title>Dashboard</title>
    <meta name="description" content="Dashboard">
    <meta name="viewport" content="width=device-width, initial-scale=1">

    <link rel="apple-touch-icon" href="apple-icon.png">

    <link rel="stylesheet" href="assets/css/normalize.css">
    <link rel="stylesheet" href="assets/css/bootstrap.min.css">
    <link rel="stylesheet" href="assets/css/font-awesome.min.css">
    <link rel="stylesheet" href="assets/css/themify-icons.css">
    <link rel="stylesheet" href="assets/css/flag-icon.min.css">
    <link rel="stylesheet" href="assets/css/cs-skin-elastic.css">
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.1.1/css/bootstrap.min.css" integrity="sha384-WskhaSGFgHYWDcbwN70/dfYBj47jz9qbsMId/iRN3ewGhXQFZCSftd1LZCfmhktB"
    crossorigin="anonymous">
    <!-- <link rel="stylesheet" href="assets/css/bootstrap-select.less"> -->
    <link rel="stylesheet" href="assets/scss/style.css">
    <script src="https://cdn.jsdelivr.net/npm/vue/dist/vue.js"></script>

    <link href='https://fonts.googleapis.com/css?family=Open+Sans:400,600,700,800' rel='stylesheet' type='text/css'>

    <!-- <script type="text/javascript" src="https://cdn.jsdelivr.net/html5shiv/3.7.3/html5shiv.min.js"></script> -->
    <style>
            /* Always set the map height explicitly to define the size of the div
             * element that contains the map. */
            #map {
              height: 50%;
            }
            html, body {
        height: 100%;
      }
            /* Optional: Makes the sample page fill the window. */

            #floating-panel {
              position: absolute;
              top: 10px;
              left: 25%;
              z-index: 5;
              background-color: #fff;
              padding: 5px;
              border: 1px solid #999;
              text-align: center;
              font-family: 'Roboto','sans-serif';
              line-height: 30px;
              padding-left: 10px;
            }
            #floating-panel {
              background-color: #fff;
              border: 1px solid #999;
              left: 25%;
              padding: 5px;
              position: absolute;
              top: 10px;
              z-index: 5;
            }
          </style>
</head>
<body>

    
    <!-- Right Panel -->
    
    <div id="right-panel" class="right-panel">

            <header id="header" class="header">

                    <div class="header-menu">
        
                        <div class="col-sm-7">
                            <div class="header-left">
                                <button class="search-trigger"><i class="fa fa-search"></i></button>
                                <div class="form-inline">
                                    <form class="search-form">
                                        <input class="form-control mr-sm-2" type="text" placeholder="Search ..." aria-label="Search">
                                        <button class="search-close" type="submit"><i class="fa fa-close"></i></button>
                                    </form>
                                </div>
                            </div>
                        </div>
        
                        <div class="col-sm-5">
                            <div class="user-area dropdown float-right">
                                <a href="#" class="dropdown-toggle" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                                    <img class="user-avatar rounded-circle" src="images/admin.jpg" alt="User Avatar">
                                </a>
        
                                <div class="user-menu dropdown-menu">
                                        <a class="nav-link isDisabled" href="#"><i class="fa fa- user"></i>Minha Conta</a>
        
                                        <a class="nav-link isDisabled" href="#"><i class="fa fa -cog"></i>Configurações</a>
        
                                        <a class="nav-link isDisabled" href="#"><i class="fa fa-power -off"></i>Logout</a>
                                </div>
                            </div>
        
                        </div>
                    </div>
        
                </header><!-- /header -->

        <div class="breadcrumbs">
            <div class="col-sm-4">
                <div class="page-header float-left">
                    <div class="page-title">
                        <h1>Dashboard</h1>
                    </div>
                </div>
            </div>
            <div class="col-sm-8">
                <div class="page-header float-right">
                    <div class="page-title">
                        <ol class="breadcrumb text-right">
                            <li class="active">Dashboard</li>
                        </ol>
                    </div>
                </div>
            </div>
        </div>

        <div id="map"></div>

        <div class="content mt-3">
            <div class="col-xl-6" id="app">
                <p style="font-size: 20px">Ranking de Rotas</p>
                            <div class="card" v-for="rota in rotas">
                                <div class="card-body">
                                    <div class="stat-widget-one">
                                        <div class="stat-icon dib"><p style="font-size: 50px; color: black; margin-top: 20px;">{{rota.ranking}}º</p></div>
                                        <div class="stat-content dib">
                                            <div class="stat-text">{{rota.name}}</div>
                                            <div class="stat-digit">{{rota.views}}</div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            

            </div>

            <div class="col-xl-6">
                <div class="card">
                    <div class="card-body">
                        <div class="row">
                            <div class="col-sm-4">
                                <h4 class="card-title mb-0">Trafégo</h4>
                                <div class="small text-muted">Maio 2018</div>
                            </div>

                        </div><!--/.row-->
                        <div class="chart-wrapper mt-4" />
                            <canvas id="trafficChart" style="height:200px;" height="200"></canvas>
                        </div>

                    </div>
                    <div class="card-footer">
                            <ul>
                                <li>
                                    <div class="text-muted">Circuito Náutico de Cacha-Pregos</div>
                                    <div class="progress progress-xs mt-2" style="height: 5px;">
                                        <div class="progress-bar bg-success"  id="trafItaparica" role="progressbar" style="width: 40%;" aria-valuenow="80" aria-valuemin="0" aria-valuemax="100"></div>
                                    </div>
                                </li>
                                <li class="hidden-sm-down">
                                    <div class="text-muted">Rolé perfeito para os últimos dias do Verão</div>
                                    <div class="progress progress-xs mt-2" style="height: 5px;">
                                        <div class="progress-bar bg-info" id="trafCachaPrego" role="progressbar" style="width: 40%;" aria-valuenow="40" aria-valuemin="0" aria-valuemax="100"></div>
                                    </div>
                                </li>
                                <li>
                                    <div class="text-muted">Forte São Marcelo</div>
                                    <div class="progress progress-xs mt-2" style="height: 5px;">
                                        <div class="progress-bar bg-warning" id="trafMadre" role="progressbar" style="width: 40%;" aria-valuenow="40" aria-valuemin="0" aria-valuemax="100"></div>
                                    </div>
                                </li>
                                <li class="hidden-sm-down">
                                    <div class="text-muted">Visita a Cacha-Pregos</div>
                                    <div class="progress progress-xs mt-2" style="height: 5px;">
                                        <div class="progress-bar bg-danger" id="trafVeraCruz" role="progressbar" style="width: 40%;" aria-valuenow="40" aria-valuemin="0" aria-valuemax="100"></div>
                                    </div>
                                </li>
                                <li class="hidden-sm-down">
                                    <div class="text-muted">Arqueologia na Baía</div>
                                    <div class="progress progress-xs mt-2" style="height: 5px;">
                                        <div class="progress-bar" id="trafPonta" role="progressbar" style="width: 40%;" aria-valuenow="40" aria-valuemin="0" aria-valuemax="100"></div>
                                    </div>
                                </li>
                            </ul>
                        </div>
                </div>
            </div>


        </div> <!-- .content -->
    </div><!-- /#right-panel -->

    <!-- Right Panel -->

    <script src="assets/js/vendor/jquery-2.1.4.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.12.3/umd/popper.min.js"></script>
    <script src="assets/js/plugins.js"></script>
    <script src="assets/js/main.js"></script>


    <script src="assets/js/lib/chart-js/Chart.bundle.js"></script>
    <script src="assets/js/dashboard.js"></script>
    <script src="assets/js/widgets.js"></script>
    <script src="assets/js/heatmap.util.js"></script>
    <script src="assets/js/trafic.util.js"></script>
  <script src="https://www.gstatic.com/firebasejs/5.0.3/firebase.js"></script>
  <script>
        // Initialize Firebase
        var config = {
          apiKey: "AIzaSyDsCcKMRngL9JSanuWcwoWwV_uQ3c6abuE",
          authDomain: "ola-baia.firebaseapp.com",
          databaseURL: "https://ola-baia.firebaseio.com",
          projectId: "ola-baia",
          storageBucket: "ola-baia.appspot.com",
          messagingSenderId: "363436448639"
        };
        firebase.initializeApp(config);
        const db = firebase.firestore();
        db.settings({ timestampsInSnapshots: true });
    
    
      </script>
      <script src="../lib/itinerary.js"></script>    
    <script>

            // This example requires the Visualization library. Include the libraries=visualization
            // parameter when you first load the API. For example:
            // <script src="https://maps.googleapis.com/maps/api/js?key=YOUR_API_KEY&libraries=visualization">
      
            var map, heatmap;
      
            function initMap() {
              map = new google.maps.Map(document.getElementById('map'), {
                zoom: 10,
                center: {lat: -12.9208526, lng: -38.7347012},
              });
      
              getPoints().then(function(heatmapPoints) {
                heatmap = new google.maps.visualization.HeatmapLayer({
                    data: heatmapPoints,
                    map: map
                });
              })
              
            }

          </script>
          <script async defer
              src="https://maps.googleapis.com/maps/api/js?key=AIzaSyBbnu4jRF4B6JZVDmyr7Ue4_bXIIXuBq7M&libraries=visualization&callback=initMap">
          </script>
    <script>

        var app = new Vue({
          el: '#app',
          data: {
            rotas: []
          },
          methods: {
            detalhe: (id) => {
              location.href = "details.html?id=" + id;
            }
          },
          created: () => {
            getItineraries().then(its => {
    
              its.forEach(it => {
                console.log(it);
                getGuide(it.id).then(guide => console.log(guide));
                getStops(it.id).then(stops => {
                  getGuide(it.id).then(guide => {
                    it.language = guide.languages.join(", ");
                    it.stops = stops;
                    it.days = stops.reduce((acc, cur) => {
                      acc += cur.duration_in_seconds;
                      return acc;
                    }, 0) / 60 / 24 ;
                    app.rotas.push(it);
                    sortByViews();
                  })
                })
              })
              
            })
          }
        })
    
    
        function sortByViews () {
          app.rotas = app.rotas.sort((a,b) => a.views < b.views).filter((rota, index) => index < 5);
          app.rotas.map((rota, index) => rota.ranking = index + 1);
          initMap();
        }
      </script>

</body>
</html>
