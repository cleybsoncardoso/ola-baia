<!doctype html>
<html lang="en">

<head>
  <!-- Required meta tags -->
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <!-- Bootstrap CSS -->
  <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.1.1/css/bootstrap.min.css" integrity="sha384-WskhaSGFgHYWDcbwN70/dfYBj47jz9qbsMId/iRN3ewGhXQFZCSftd1LZCfmhktB"
    crossorigin="anonymous">
  <link href="style.css" rel="stylesheet">
  <link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.0.13/css/all.css" integrity="sha384-DNOHZ68U8hZfKXOrtjWvjxusGo9WQnrNx2sqG0tfsghAvtVlRW3tvkXWZh58N9jp"
    crossorigin="anonymous">
  <title>Olá Baía</title>
  <script src="https://cdn.jsdelivr.net/npm/vue/dist/vue.js"></script>
</head>

<body>

  <header>
    <div class="container d-flex flex-column flex-md-row align-items-center p-3 bg-white border-bottom">
      <a href="/" class="mr-md-auto">
        <img src="logo.png" height="50">
      </a>
      <nav class="my-2 my-md-0 mr-md-3">
        <a class="p-2 menu-header" href="/">Home</a>
        <a class="p-2 menu-header" href="/">Roteiros</a>
        <a class="p-2 menu-header" href="/">Sou Guia</a>
        <a class="p-2 menu-header" href="/">Blog</a>
      </nav>
    </div>
  </header>

  <main role="main">

    <section class="jumbotron text-center" style="background-image: url(salvador.png); background-position: center;"></section>

    <div class="container" id="app">
      <div class="summary">
        <div class="row">
          <div class="col-md-7">
            <h2>{{rota.name}}</h2>
            <p>{{rota.description}}</p>
            <div class="coracao" style="padding:0px; display: inline-block; margin-right: 10px;">
              <input type="radio" id="cm_star-empty" name="fb" value="" checked/>
              <label for="cm_star-1">
                <i class="fa"></i>
              </label>
              <input type="radio" id="cm_star-1" name="fb" value="1" />
              <label for="cm_star-2">
                <i class="fa"></i>
              </label>
              <input type="radio" id="cm_star-2" name="fb" value="2" />
              <label for="cm_star-3">
                <i class="fa"></i>
              </label>
              <input type="radio" id="cm_star-3" name="fb" value="3" />
              <label for="cm_star-4">
                <i class="fa"></i>
              </label>
              <input type="radio" id="cm_star-4" name="fb" value="4" checked/>
              <label for="cm_star-5">
                <i class="fa"></i>
              </label>
              <input type="radio" id="cm_star-5" name="fb" value="5" />
            </div>
            <span style="font-size: 9px;">{{rota.likes}} pessoas gostaram desse roteiro</span>
            <hr>
            <div style="font-size: 12px;">
              <p>
                <b>Duração do Roteiro:</b> {{Math.ceil(rota.days)}} dia(s)
                <br>
                <b>Idioma:</b> {{rota.language}}
              </p>
            </div>
            <hr>
            <div class="guia">
              <div class="row">
                <div class="col-md-4">
                  <img src="guia.png" width="100%">
                </div>
                <div class="col-md-8">
                  <h5 style="color: #A8A8A8">Seu guia nesse roteiro</h5>
                  <h2>{{rota.guide.name}}</h2>
                  <p>{{rota.guide.description}}</p>
                  <div style="float: right;">
                    <button type="button" class="btn btn-primary">Entrar em contato</button>
                  </div>
                </div>
              </div>
            </div>
          </div>
          <div class="col-md-5">
            <h2>Orçamento para esse roteiro</h2>
            <h3 style="color: #00CF8D; font-weight: bold;">R$ {{rota.price}}</h3>
            <hr>
            <div class="pricing">
              <p class="title">Alimentação ..................................... R$ {{rota.price/3}}</p>
              <p class="description">Café da manhã; Almoço; Jantar. (Todos os dias)</b></p>

              <p class="title">Alimentação ..................................... R$ {{rota.price/3}}</p>
              <p class="description">Café da manhã; Almoço; Jantar. (Todos os dias)</b></p>

              <p class="title">Alimentação ..................................... R$ {{rota.price/3}}</p>
              <p class="description">Café da manhã; Almoço; Jantar. (Todos os dias)</b></p>
            </div>
          </div>
        </div>
      </div>
      </div>
      <div class="bg-light" style="margin-top: 30px; padding-top: 10px; padding-bottom: 10px;">
        <div class="container">
          <div class="more-details">
            <h3 class="title-card">Detalhas do roteiro</h3>
            <div id="map"></div>

            <div style="margin-top: 20px; margin-bottom: 20px">
              <h4>Primeiro dia:</h4>
              <p>Lorem ipsum dolor sit amet, consectetur adipiscing elit. Pellentesque lobortis consequat nisl, non egestas erat facilisis vel. Aenean ut dignissim ex. Proin et commodo mauris, rutrum pulvinar lacus. Donec condimentum commodo est mollis viverra. Nunc elementum, sapien sed sodales dignissim, libero enim accumsan dolor, ut malesuada dui dolor ac leo. Donec vel aliquam magna. Nullam efficitur est orci, ut pretium metus facilisis vehicula. Suspendisse faucibus dolor eu euismod ultrices. Etiam ut pellentesque neque, vel maximus ligula. Sed vitae lacus mi.</p>
            </div>

            <div style="margin-top: 20px; margin-bottom: 20px">
              <h4>Segundo dia:</h4>
              <p>Lorem ipsum dolor sit amet, consectetur adipiscing elit. Pellentesque lobortis consequat nisl, non egestas erat facilisis vel. Aenean ut dignissim ex. Proin et commodo mauris, rutrum pulvinar lacus. Donec condimentum commodo est mollis viverra. Nunc elementum, sapien sed sodales dignissim, libero enim accumsan dolor, ut malesuada dui dolor ac leo. Donec vel aliquam magna. Nullam efficitur est orci, ut pretium metus facilisis vehicula. Suspendisse faucibus dolor eu euismod ultrices. Etiam ut pellentesque neque, vel maximus ligula. Sed vitae lacus mi.</p>
            </div>

            <div style="margin-top: 20px; margin-bottom: 20px">
              <h4>Terceiro dia:</h4>
              <p>Lorem ipsum dolor sit amet, consectetur adipiscing elit. Pellentesque lobortis consequat nisl, non egestas erat facilisis vel. Aenean ut dignissim ex. Proin et commodo mauris, rutrum pulvinar lacus. Donec condimentum commodo est mollis viverra. Nunc elementum, sapien sed sodales dignissim, libero enim accumsan dolor, ut malesuada dui dolor ac leo. Donec vel aliquam magna. Nullam efficitur est orci, ut pretium metus facilisis vehicula. Suspendisse faucibus dolor eu euismod ultrices. Etiam ut pellentesque neque, vel maximus ligula. Sed vitae lacus mi.</p>
            </div>

            <div style="text-align: center; margin-bottom: 20px;">
              <button type="button" class="btn btn-sm btn-outline-secondary" style="margin-right: 20px;">Quero falar com o Guia</button>
              <button type="button" class="btn btn-sm btn-outline-secondary">
                <i class="fas fa-heart" style="color: red;"></i>
                Amei esse roteiro!
              </button>
            </div>
          </div>
        </div>
      </div>
  </main>

  <footer class="text-muted">
    <div class="container">
      <p class="float-right">
        <a href="#">Voltar ao Topo</a>
      </p>
      <p>Feito com <span style="color:#db4437; font-size: 1.5rem">&hearts;</span> por Olá Bahia</p>
  </footer>

  <!-- Optional JavaScript -->
  <!-- jQuery first, then Popper.js, then Bootstrap JS -->
  <script src="https://code.jquery.com/jquery-3.3.1.slim.min.js" integrity="sha384-q8i/X+965DzO0rT7abK41JStQIAqVgRVzpbzo5smXKp4YfRvH+8abtTE1Pi6jizo"
    crossorigin="anonymous"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.3/umd/popper.min.js" integrity="sha384-ZMP7rVo3mIykV+2+9J3UJ46jBk0WLaUAdn689aCwoqbBJiSnjAK/l8WvCWPIPm49"
    crossorigin="anonymous"></script>
  <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.1.1/js/bootstrap.min.js" integrity="sha384-smHYKdLADwkXOn1EmN1qk/HfnUcbVRZyYmZ4qpPea6sjB/pTJ0euyQp0Mk8ck+5T"
    crossorigin="anonymous"></script>
  <script src="holder.min.js"></script>
  <script src="https://www.gstatic.com/firebasejs/5.0.3/firebase.js"></script>
  <script>

  </script>
  <script>
    function getParameterByName(name, url) {
      if (!url) url = window.location.href;
      name = name.replace(/[\[\]]/g, "\\$&");
      var regex = new RegExp("[?&]" + name + "(=([^&#]*)|&|#|$)"),
        results = regex.exec(url);
      if (!results) return null;
      if (!results[2]) return '';
      return decodeURIComponent(results[2].replace(/\+/g, " "));
    }
  </script>
  <script src="./lib/itinerary.js"></script>
  
  <script>
    var id = getParameterByName("id");

    // Initialize Firebase
    var config = {
      apiKey: "AIzaSyDsCcKMRngL9JSanuWcwoWwV_uQ3c6abuE",
      authDomain: "ola-baia.firebaseapp.com",
      databaseURL: "https://ola-baia.firebaseio.com",
      projectId: "ola-baia",
      storageBucket: "ola-baia.appspot.com",
      messagingSenderId: "363436448639"
    };
    firebase.initializeApp(config);

    // Initialize Firebase
    var db = firebase.firestore();
    db.settings({ timestampsInSnapshots: true });

    var rota = {};

    var app = new Vue({
      el: '#app',
      data: {
        rota: {
          guide: {}
        }
      },
      created: () => {
        getItineraryById(id).then(it => {

          console.log(it);
          getStops(id).then(stops => {
            getGuide(id).then(guide => {
              console.log(guide);
              it.language = guide.languages.join(", ");
              it.stops = stops;
              it.guide = guide;
              it.days = stops.reduce((acc, cur) => {
                acc += cur.duration_in_seconds;
                return acc;
              }, 0) / 60 / 24 ;
              app.rota = it;
              rota = it;
              console.log(it.stops)
            })
          })

        })
      }
    })

    function initMap() {
      setTimeout(() => {
        var directionsService = new google.maps.DirectionsService;
        var directionsDisplay = new google.maps.DirectionsRenderer;
        var uluru = new google.maps.LatLng(rota.stops[0].location._lat, rota.stops[0].location._long);
        var map = new google.maps.Map(document.getElementById('map'), {
          zoom: 110,
          center: uluru
        });
        
        directionsDisplay.setMap(map);
        
        directionsService.route({
            origin: new google.maps.LatLng(rota.stops[0].location._lat, rota.stops[0].location._long),
            destination: new google.maps.LatLng(rota.stops[app.rota.stops.length-1].location._lat, rota.stops[app.rota.stops.length-1].location._long),
            waypoints: rota.stops.map(stop => ({location: new google.maps.LatLng(stop.location._lat, stop.location._long), stopover: true})),
            travelMode: 'DRIVING'
          }, function(response, status) {
            if (status === 'OK') {
              directionsDisplay.setDirections(response);
              var route = response.routes[0];
            } else {
              window.alert('Directions request failed due to ' + status);
            }
          });
      }, 3000);
      
    }
    
  </script>
  <script async defer
  src="https://maps.googleapis.com/maps/api/js?key=AIzaSyBbnu4jRF4B6JZVDmyr7Ue4_bXIIXuBq7M&callback=initMap">
  </script>
</body>

</html>